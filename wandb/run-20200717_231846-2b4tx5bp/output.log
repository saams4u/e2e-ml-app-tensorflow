2020-07-17 18:18:58.784905: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cudart64_101.dll

2020-07-17 18:19:01,938:INFO:train.py:<module>:146:
{
    "cuda": false,
    "seed": 1234,
    "shuffle": true,
    "data_url": "https://raw.githubusercontent.com/madewithml/lessons/master/data/news.csv",
    "lower": true,
    "char_level": false,
    "filters": "[!\\\"'#$%&()*\\+,-./:;<=>?@\\\\\\[\\]^_`{|}~]",
    "data_size": 1.0,
    "train_size": 0.7,
    "val_size": 0.15,
    "test_size": 0.15,
    "num_epochs": 10,
    "batch_size": 64,
    "embedding_dim": 100,
    "use_glove": true,
    "freeze_embeddings": false,
    "filter_sizes": [
        2,
        3,
        4
    ],
    "num_filters": 50,
    "hidden_dim": 128,
    "dropout_p": 0.1,
    "learning_rate": 0.0001,
    "patience": 3
}

2020-07-17 18:19:04,698:INFO:train.py:<module>:158:
Raw data:
  Sharon Accepts Plan to Reduce Gaza Army Operation, Haaretz Says World

2020-07-17 18:19:05,738:INFO:train.py:<module>:172:
Data splits:
	X_train: 78030, y_train: 78030
	X_val: 13770, y_val: 13770
	X_test: 16200, y_test: 16200

2020-07-17 18:19:06,816:INFO:train.py:<module>:183:
vocab_size: 28565

2020-07-17 18:19:08,091:INFO:train.py:<module>:192:
Text to indices:
  (raw) Chain Store Sales Rise in the Latest Week
  (preprocessed) chain store sales rise in the latest week
  (tokenized) [1922, 701, 58, 79, 3, 9, 498, 191]

2020-07-17 18:19:08,093:INFO:train.py:<module>:202:
classes:
  ['Business' 'Sci/Tech' 'Sports' 'World']

2020-07-17 18:19:08,104:INFO:train.py:<module>:218:
class counts:
  [19548 19497 19485 19500]
class weights:
  {0: 5.11561285041948e-05, 1: 5.128994204236549e-05, 2: 5.132152938157557e-05, 3: 5.128205128205128e-05}

2020-07-17 18:19:08,105:INFO:train.py:<module>:235:
Dataset generators:
  (training_generator) <DataGenerator(batch_size=64, batches=1220, shuffle=False)>
  (validation_generator) <DataGenerator(batch_size=64, batches=216, shuffle=False)>
  (testing_generator) <DataGenerator(batch_size=64, batches=254, shuffle=False)>
Sample batch:
  X: (64, 15)
  y: (64,)


2020-07-17 18:19:23,767:INFO:train.py:<module>:257:
GloVe Embeddings:
(28565, 100)
2020-07-17 18:19:23.893854: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library nvcuda.dll
2020-07-17 18:19:24.143290: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1561] Found device 0 with properties: 
pciBusID: 0000:01:00.0 name: GeForce GTX 1060 computeCapability: 6.1
coreClock: 1.6705GHz coreCount: 10 deviceMemorySize: 6.00GiB deviceMemoryBandwidth: 178.99GiB/s
2020-07-17 18:19:24.143891: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cudart64_101.dll
2020-07-17 18:19:24.229835: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cublas64_10.dll
2020-07-17 18:19:24.290365: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cufft64_10.dll
2020-07-17 18:19:24.315342: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library curand64_10.dll
2020-07-17 18:19:24.391878: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cusolver64_10.dll
2020-07-17 18:19:24.429106: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cusparse64_10.dll
2020-07-17 18:19:24.531245: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cudnn64_7.dll
2020-07-17 18:19:24.532630: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1703] Adding visible gpu devices: 0
2020-07-17 18:19:24.536030: I tensorflow/core/platform/cpu_feature_guard.cc:143] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2
2020-07-17 18:19:25.066498: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x12b0310ace0 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
2020-07-17 18:19:25.067875: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version
2020-07-17 18:19:25.119542: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1561] Found device 0 with properties: 
pciBusID: 0000:01:00.0 name: GeForce GTX 1060 computeCapability: 6.1
coreClock: 1.6705GHz coreCount: 10 deviceMemorySize: 6.00GiB deviceMemoryBandwidth: 178.99GiB/s
2020-07-17 18:19:25.120290: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cudart64_101.dll
2020-07-17 18:19:25.122650: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cublas64_10.dll
2020-07-17 18:19:25.123013: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cufft64_10.dll
2020-07-17 18:19:25.123346: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library curand64_10.dll
2020-07-17 18:19:25.123668: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cusolver64_10.dll
2020-07-17 18:19:25.124005: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cusparse64_10.dll
2020-07-17 18:19:25.124307: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cudnn64_7.dll
2020-07-17 18:19:25.125447: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1703] Adding visible gpu devices: 0
2020-07-17 18:19:28.042403: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1102] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-07-17 18:19:28.042649: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1108]      0 
2020-07-17 18:19:28.042793: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1121] 0:   N 
2020-07-17 18:19:28.044773: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1247] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 4700 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1060, pci bus id: 0000:01:00.0, compute capability: 6.1)
2020-07-17 18:19:28.105871: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x12b4025fe60 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:
2020-07-17 18:19:28.106254: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): GeForce GTX 1060, Compute Capability 6.1
--- Logging error ---
Traceback (most recent call last):
  File "C:\Users\mahjo\AppData\Local\Programs\Python\Python36\Lib\logging\__init__.py", line 996, in emit
    stream.write(msg)
  File "C:\Users\mahjo\e2e-ml-app-tensorflow\venv\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 141: character maps to <undefined>
Call stack:
  File "text_classification/train.py", line 165, in <module>
    "Preprocessed data:\n"
Message: 'Preprocessed data:\n  Sharon Accepts Plan to Reduce Gaza Army Operation, Haaretz Says \u2192 Sharon Accepts Plan to Reduce Gaza Army Operation , Haaretz Says'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "C:\Users\mahjo\AppData\Local\Programs\Python\Python36\Lib\logging\__init__.py", line 996, in emit
    stream.write(msg)
  File "C:\Users\mahjo\e2e-ml-app-tensorflow\venv\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 86: character maps to <undefined>
Call stack:
  File "text_classification/train.py", line 211, in <module>
    "Labels to indices:\n"
Message: 'Labels to indices:\n  Business \u2192 0'
Arguments: ()
wandb: ERROR wandb.init hasn't been called, can't configure run
2020-07-17 18:19:28.734892: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cudnn64_7.dll
2020-07-17 18:19:31.202333: W tensorflow/stream_executor/gpu/redzone_allocator.cc:314] Internal: Invoking GPU asm compilation is supported on Cuda non-Windows platforms only
Relying on driver to perform ptx compilation. 
Modify $PATH to customize ptxas location.
This message will be only logged once.
2020-07-17 18:19:31.259123: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cublas64_10.dll
Epoch 1/10

   1/1220 [..............................] - ETA: 0s - loss: 1.6734 - accuracy: 0.2500
   2/1220 [..............................] - ETA: 4:34 - loss: 1.7757 - accuracy: 0.2148
   3/1220 [..............................] - ETA: 4:17 - loss: 1.7099 - accuracy: 0.2075
   4/1220 [..............................] - ETA: 4:34 - loss: 1.6570 - accuracy: 0.2103
   5/1220 [..............................] - ETA: 4:19 - loss: 1.6484 - accuracy: 0.2126
   6/1220 [..............................] - ETA: 4:20 - loss: 1.6383 - accuracy: 0.2149
   7/1220 [..............................] - ETA: 4:01 - loss: 1.6260 - accuracy: 0.2164
   8/1220 [..............................] - ETA: 4:29 - loss: 1.6181 - accuracy: 0.2170
   9/1220 [..............................] - ETA: 4:15 - loss: 1.6104 - accuracy: 0.2170
  10/1220 [..............................] - ETA: 4:13 - loss: 1.6001 - accuracy: 0.2175
  11/1220 [..............................] - ETA: 4:48 - loss: 1.5795 - accuracy: 0.2195
  12/1220 [..............................] - ETA: 4:39 - loss: 1.5719 - accuracy: 0.2216
  14/1220 [..............................] - ETA: 4:05 - loss: 1.5347 - accuracy: 0.2267
  16/1220 [..............................] - ETA: 3:39 - loss: 1.5150 - accuracy: 0.2310
  18/1220 [..............................] - ETA: 3:20 - loss: 1.4973 - accuracy: 0.2350
  19/1220 [..............................] - ETA: 3:19 - loss: 1.4887 - accuracy: 0.2371
  21/1220 [..............................] - ETA: 3:03 - loss: 1.4790 - accuracy: 0.2408
  23/1220 [..............................] - ETA: 2:57 - loss: 1.4674 - accuracy: 0.2442
  25/1220 [..............................] - ETA: 2:46 - loss: 1.4591 - accuracy: 0.2476
  27/1220 [..............................] - ETA: 2:37 - loss: 1.4520 - accuracy: 0.2512
  29/1220 [..............................] - ETA: 2:29 - loss: 1.4470 - accuracy: 0.2545
  30/1220 [..............................] - ETA: 2:30 - loss: 1.4424 - accuracy: 0.2560
  32/1220 [..............................] - ETA: 2:28 - loss: 1.4346 - accuracy: 0.2589
  34/1220 [..............................] - ETA: 2:21 - loss: 1.4289 - accuracy: 0.2614
  36/1220 [..............................] - ETA: 2:15 - loss: 1.4234 - accuracy: 0.2638
  38/1220 [..............................] - ETA: 2:10 - loss: 1.4159 - accuracy: 0.2662
  40/1220 [..............................] - ETA: 2:05 - loss: 1.4081 - accuracy: 0.2687
  42/1220 [>.............................] - ETA: 2:01 - loss: 1.3990 - accuracy: 0.2713
  44/1220 [>.............................] - ETA: 1:57 - loss: 1.3935 - accuracy: 0.2738
  46/1220 [>.............................] - ETA: 1:54 - loss: 1.3849 - accuracy: 0.2764
  48/1220 [>.............................] - ETA: 1:50 - loss: 1.3799 - accuracy: 0.2789
  50/1220 [>.............................] - ETA: 1:47 - loss: 1.3743 - accuracy: 0.2814
  52/1220 [>.............................] - ETA: 1:44 - loss: 1.3662 - accuracy: 0.2840
  54/1220 [>.............................] - ETA: 1:42 - loss: 1.3611 - accuracy: 0.2865
  56/1220 [>.............................] - ETA: 1:39 - loss: 1.3561 - accuracy: 0.2890
  58/1220 [>.............................] - ETA: 1:37 - loss: 1.3502 - accuracy: 0.2915
  60/1220 [>.............................] - ETA: 1:35 - loss: 1.3435 - accuracy: 0.2939
  62/1220 [>.............................] - ETA: 1:34 - loss: 1.3386 - accuracy: 0.2964
  64/1220 [>.............................] - ETA: 1:32 - loss: 1.3328 - accuracy: 0.2987
  66/1220 [>.............................] - ETA: 1:30 - loss: 1.3270 - accuracy: 0.3011
  68/1220 [>.............................] - ETA: 1:28 - loss: 1.3235 - accuracy: 0.3034
  70/1220 [>.............................] - ETA: 1:27 - loss: 1.3177 - accuracy: 0.3057
  71/1220 [>.............................] - ETA: 1:28 - loss: 1.3161 - accuracy: 0.3068
  73/1220 [>.............................] - ETA: 1:27 - loss: 1.3109 - accuracy: 0.3091
  75/1220 [>.............................] - ETA: 1:25 - loss: 1.3064 - accuracy: 0.3113
  77/1220 [>.............................] - ETA: 1:24 - loss: 1.2998 - accuracy: 0.3136
  79/1220 [>.............................] - ETA: 1:22 - loss: 1.2947 - accuracy: 0.3158
  81/1220 [>.............................] - ETA: 1:21 - loss: 1.2890 - accuracy: 0.3181
  83/1220 [=>............................] - ETA: 1:20 - loss: 1.2835 - accuracy: 0.3203
  85/1220 [=>............................] - ETA: 1:19 - loss: 1.2803 - accuracy: 0.3225
  87/1220 [=>............................] - ETA: 1:18 - loss: 1.2771 - accuracy: 0.3247
  89/1220 [=>............................] - ETA: 1:17 - loss: 1.2726 - accuracy: 0.3268
  91/1220 [=>............................] - ETA: 1:16 - loss: 1.2671 - accuracy: 0.3289
  93/1220 [=>............................] - ETA: 1:14 - loss: 1.2632 - accuracy: 0.3310
  95/1220 [=>............................] - ETA: 1:13 - loss: 1.2587 - accuracy: 0.3331
  97/1220 [=>............................] - ETA: 1:13 - loss: 1.2541 - accuracy: 0.3352
  98/1220 [=>............................] - ETA: 1:12 - loss: 1.2523 - accuracy: 0.3362
 100/1220 [=>............................] - ETA: 1:12 - loss: 1.2467 - accuracy: 0.3383
 102/1220 [=>............................] - ETA: 1:11 - loss: 1.2425 - accuracy: 0.3404
 104/1220 [=>............................] - ETA: 1:10 - loss: 1.2373 - accuracy: 0.3424
 106/1220 [=>............................] - ETA: 1:09 - loss: 1.2322 - accuracy: 0.3445
 108/1220 [=>............................] - ETA: 1:09 - loss: 1.2285 - accuracy: 0.3465
 110/1220 [=>............................] - ETA: 1:08 - loss: 1.2248 - accuracy: 0.3485
 112/1220 [=>............................] - ETA: 1:07 - loss: 1.2197 - accuracy: 0.3505
 114/1220 [=>............................] - ETA: 1:07 - loss: 1.2143 - accuracy: 0.3525
 116/1220 [=>............................] - ETA: 1:06 - loss: 1.2091 - accuracy: 0.3546
 118/1220 [=>............................] - ETA: 1:05 - loss: 1.2055 - accuracy: 0.3566
 120/1220 [=>............................] - ETA: 1:05 - loss: 1.2007 - accuracy: 0.3586
 122/1220 [==>...........................] - ETA: 1:04 - loss: 1.1972 - accuracy: 0.3606
 124/1220 [==>...........................] - ETA: 1:03 - loss: 1.1936 - accuracy: 0.3625
 126/1220 [==>...........................] - ETA: 1:03 - loss: 1.1886 - accuracy: 0.3645
 128/1220 [==>...........................] - ETA: 1:02 - loss: 1.1845 - accuracy: 0.3664
 130/1220 [==>...........................] - ETA: 1:02 - loss: 1.1819 - accuracy: 0.3683
 132/1220 [==>...........................] - ETA: 1:01 - loss: 1.1769 - accuracy: 0.3702
 134/1220 [==>...........................] - ETA: 1:01 - loss: 1.1738 - accuracy: 0.3720
 136/1220 [==>...........................] - ETA: 1:00 - loss: 1.1693 - accuracy: 0.3739
 138/1220 [==>...........................] - ETA: 1:00 - loss: 1.1649 - accuracy: 0.3757
 140/1220 [==>...........................] - ETA: 59s - loss: 1.1619 - accuracy: 0.3775 
 142/1220 [==>...........................] - ETA: 59s - loss: 1.1579 - accuracy: 0.3793
 144/1220 [==>...........................] - ETA: 59s - loss: 1.1536 - accuracy: 0.3811
 146/1220 [==>...........................] - ETA: 58s - loss: 1.1500 - accuracy: 0.3829
 147/1220 [==>...........................] - ETA: 3:04 - loss: 1.1479 - accuracy: 0.3837
 149/1220 [==>...........................] - ETA: 3:02 - loss: 1.1436 - accuracy: 0.3855
 151/1220 [==>...........................] - ETA: 2:59 - loss: 1.1411 - accuracy: 0.3872
 153/1220 [==>...........................] - ETA: 2:57 - loss: 1.1370 - accuracy: 0.3889
 155/1220 [==>...........................] - ETA: 2:55 - loss: 1.1333 - accuracy: 0.3906
 157/1220 [==>...........................] - ETA: 2:53 - loss: 1.1298 - accuracy: 0.3923
 159/1220 [==>...........................] - ETA: 2:51 - loss: 1.1250 - accuracy: 0.3940
 161/1220 [==>...........................] - ETA: 2:49 - loss: 1.1211 - accuracy: 0.3956
 163/1220 [===>..........................] - ETA: 2:47 - loss: 1.1174 - accuracy: 0.3973
 165/1220 [===>..........................] - ETA: 2:45 - loss: 1.1141 - accuracy: 0.3989
 167/1220 [===>..........................] - ETA: 2:43 - loss: 1.1098 - accuracy: 0.4006
 169/1220 [===>..........................] - ETA: 2:41 - loss: 1.1049 - accuracy: 0.4022
 171/1220 [===>..........................] - ETA: 2:39 - loss: 1.1016 - accuracy: 0.4038
 173/1220 [===>..........................] - ETA: 2:38 - loss: 1.0978 - accuracy: 0.4054
 175/1220 [===>..........................] - ETA: 2:36 - loss: 1.0944 - accuracy: 0.4070
 177/1220 [===>..........................] - ETA: 2:34 - loss: 1.0902 - accuracy: 0.4086Traceback (most recent call last):
  File "text_classification/train.py", line 287, in <module>
    callbacks=callbacks, shuffle=False, class_weight=class_weights, verbose=1)
  File "C:\Users\mahjo\e2e-ml-app-tensorflow\venv\lib\site-packages\tensorflow\python\keras\engine\training.py", line 66, in _method_wrapper
    return method(self, *args, **kwargs)
  File "C:\Users\mahjo\e2e-ml-app-tensorflow\venv\lib\site-packages\tensorflow\python\keras\engine\training.py", line 848, in fit
    tmp_logs = train_function(iterator)
  File "C:\Users\mahjo\e2e-ml-app-tensorflow\venv\lib\site-packages\tensorflow\python\eager\def_function.py", line 580, in __call__
    result = self._call(*args, **kwds)
  File "C:\Users\mahjo\e2e-ml-app-tensorflow\venv\lib\site-packages\tensorflow\python\eager\def_function.py", line 611, in _call
    return self._stateless_fn(*args, **kwds)  # pylint: disable=not-callable
  File "C:\Users\mahjo\e2e-ml-app-tensorflow\venv\lib\site-packages\tensorflow\python\eager\function.py", line 2420, in __call__
    return graph_function._filtered_call(args, kwargs)  # pylint: disable=protected-access
  File "C:\Users\mahjo\e2e-ml-app-tensorflow\venv\lib\site-packages\tensorflow\python\eager\function.py", line 1665, in _filtered_call
    self.captured_inputs)
  File "C:\Users\mahjo\e2e-ml-app-tensorflow\venv\lib\site-packages\tensorflow\python\eager\function.py", line 1746, in _call_flat
    ctx, args, cancellation_manager=cancellation_manager))
  File "C:\Users\mahjo\e2e-ml-app-tensorflow\venv\lib\site-packages\tensorflow\python\eager\function.py", line 598, in call
    ctx=ctx)
  File "C:\Users\mahjo\e2e-ml-app-tensorflow\venv\lib\site-packages\tensorflow\python\eager\execute.py", line 60, in quick_execute
    inputs, attrs, num_outputs)
KeyboardInterrupt
2020-07-17 18:20:03.339058: W tensorflow/core/kernels/data/generator_dataset_op.cc:103] Error occurred when finalizing GeneratorDataset iterator: Failed precondition: Python interpreter state is not initialized. The process may be terminated.
	 [[{{node PyFunc}}]]
